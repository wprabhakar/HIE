{"version":3,"sources":["../../src/pages/orders/orders.module.ts","../../src/pages/orders/orders.ts"],"names":[],"mappings":"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","file":"12.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { OrdersPage } from './orders';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    OrdersPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(OrdersPage),\r\n  ],\r\n  exports: [\r\n    OrdersPage\r\n  ]\r\n})\r\nexport class OrdersPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/orders/orders.module.ts","//import { NgZone } from '@angular/core';\nimport { Component } from '@angular/core';\nimport { IonicPage, NavController, LoadingController, Loading } from 'ionic-angular';\nimport { APIService } from '../../providers/api-service';\nimport { LoginService } from '../../providers/login-service';\n//import { sIMAGE_URL } from '../../app/properties';\nimport { getStartTime } from '../../app/properties';\nimport { lookupTime } from '../../app/properties';\nimport { lookupStatus } from '../../app/properties';\nimport { Global_Variables } from '../../app/properties';\nimport { Calendar } from '@ionic-native/calendar';\nimport { Diagnostic } from '@ionic-native/diagnostic';\n//import * as moment from 'moment';\n\n@IonicPage()\n@Component({\n  selector: 'page-orders',\n  templateUrl: 'orders.html'\n})\nexport class OrdersPage {\n  public oItems: any[] = [];\n  private bLoaded = false;\n  private bShowUpcoming = true;\n  private loading: Loading;\n  sErrorText: string = 'NO RESULT' ;\n  private options: any = {\n    firstReminderMinutes: 5\n  };\n  constructor(\n    //public zone: NgZone, \n    public navCtrl: NavController, public oAPIService: APIService, public readonly loadingCtrl: LoadingController,\n    private oCalendar: Calendar,\n    private oDiagnostic: Diagnostic,\n    public oLoginService: LoginService) {\n    // oCalendar.listCalendars().then((data) => {\n    //   console.log(\"OLD List: \" + JSON.stringify(data));\n    // });\n    // oCalendar.createCalendar('HIE-Calendar').then((d) => {\n    //   oCalendar.listCalendars().then((data) => {\n    //     console.log(\"NEW List: \" + JSON.stringify(data));\n    //   });\n    // });\n    Global_Variables.sCurrentPage = 'My transaction';\n  }\n  ionViewDidLoad() {\n    this.loadUpcoming(true);\n  }\n  getColor(oItem: any) {\n    if (oItem.STATUS == 'P')\n      return \"red\";\n    if (oItem.STATUS == 'C')\n      return \"green\";\n  }\n  onRemindMe(oItem: any) {\n    this.oDiagnostic.isCalendarAuthorized().then((authorized) => {\n      if (authorized)\n        this.setReminder(oItem);\n    });\n  }\n\n  getStartDate(oItem: any): Date {\n    var STARTDATE = this.oAPIService.stringToDate(oItem.PICKUPON, \"yyyy-mm-dd\", \"-\");\n    var STARTTIME = getStartTime(oItem.PICKUPSTART);\n    return this.oAPIService.setTime24Hrs(STARTDATE, STARTTIME);\n  }\n  formulateEventInfo(oItem: any) {\n    var oEvent: any = {};\n    oEvent.TITLE = 'HIEarly - Collection';\n    oEvent.NOTES = oItem.NAME + ' ' + oItem.BOOKINGREF;\n    oEvent.STARTDATE = this.getStartDate(oItem);\n    oEvent.ENDDATE = oEvent.STARTDATE;\n    return oEvent;\n  }\n  setReminder(oItem: any) {\n    var e = this.formulateEventInfo(oItem);\n    this.oCalendar.createEventWithOptions(e.TITLE, null, e.NOTES, e.STARTDATE, e.ENDDATE, this.options).then((data) => {\n      oItem.REMIND = 'N';\n    }).catch((err) => {\n      oItem.REMIND = 'Y';\n    });\n  }\n\n  checkCalendar(oItems: any): any {\n    return oItems.reduce((oPromise, oItem) => {\n      return oPromise.then((data) => {\n        return this.checkReminderSet(oItem).then((data) => {\n          if (data.length == 0)\n            oItem.REMIND = 'Y';\n          else\n            oItem.REMIND = 'N';\n          // console.error(\"Lookup of Event: \" + JSON.stringify(data) + \" => \" + JSON.stringify(data));\n        }).catch((err) => {\n          console.error(JSON.stringify(err))\n        });\n      });\n    }, Promise.resolve());\n  }\n  //  @synchronize()\n  checkReminderSet(oItem: any): any {\n    var e = this.formulateEventInfo(oItem);\n//    console.log(\"Checking: \" + JSON.stringify(e));\n    return this.oCalendar.findEvent(e.TITLE, null, e.NOTES, e.STARTDATE, e.ENDDATE);\n  }\n\n  showUpcoming() {\n    this.oAPIService.send2ServerP(\"customer/orders\").then((data: any) => {\n      this.oItems = data.result;\n      this.updateStatusMessage(true);\n    }).catch((err) => {\n      console.log('Error:' + JSON.stringify(err));\n      this.bLoaded = true;\n      this.loading.dismissAll() ;\n    });\n  }\n  oCheckReminders = [];\n  updateStatusMessage(b: boolean) {\n    if (this.oItems.length == 0) {\n      this.bShowUpcoming = b;\n      this.bLoaded = true;\n      this.loading.dismissAll() ;\n      return;\n    }\n    this.oCheckReminders = [];\n    this.oAPIService.sort(this.oItems, [{ field: 'PICKUPON', direction: 'desc' }, { field: 'PICKUPSTART', direction: 'desc' }, { field: 'BOOKINGREF', direction: 'desc' }]);\n    this.oItems.forEach((obj, idx) => {\n      if (obj.STATUS == 'C') {\n        obj.REMIND = 'Y';\n        //         if (this.oAPIService.isFuture(this.getStartDate(obj))) {\n        this.oCheckReminders.push(obj);\n        //        }\n      }\n      obj.PICKUPTIME = lookupTime(obj.PICKUPSTART);\n      obj.STATUS_MESSAGE = lookupStatus(obj.STATUS);\n      if (idx == this.oItems.length - 1) {\n        this.bShowUpcoming = b;\n        if (this.oCheckReminders.length > 0) {\n          this.checkCalendar(this.oCheckReminders).then((d) => {\n            this.loading.dismissAll() ;\n            this.bLoaded = true;\n          }).catch((err) => {\n            this.loading.dismissAll() ;\n            this.bLoaded = true;\n            console.log(\"ERROR: \" + JSON.stringify(err));\n          });\n        }\n        else {\n          this.loading.dismissAll() ;\n          this.bLoaded = true;\n        }\n      }\n    });\n  }\n\n  showHistory() {\n    this.oAPIService.send2ServerP(\"customer/orderhistory\").then((data: any) => {\n      console.log(JSON.stringify(data));\n      this.oItems = data.result;\n      this.updateStatusMessage(false);\n    }).catch((err) => {\n      console.log('Error:' + JSON.stringify(err));\n      this.loading.dismissAll() ;\n    });\n  }\n  loadUpcoming(b: boolean) {\n    this.bLoaded = false;\n    this.oItems = [];\n    this.loading = this.loadingCtrl.create({\n      content: 'loading...',\n    });\n    this.loading.present();\n    if (b)\n      this.showUpcoming();\n    else\n      this.showHistory();\n  }\n  getMenuClass(b: boolean) {\n    if (b == this.bShowUpcoming)\n      return \"ksd-menu-options-selected\";\n    return \"ksd-menu-options\";\n  }\n\n  // getImageURL(oItem: any, o: any) {\n  //   let img = oItem.IMAGE_URL;\n  //   if (img == null)\n  //     return '';\n  //   if (img.startsWith('http://') ||\n  //     img.startsWith('https://'))\n  //     return img;\n  //   return sIMAGE_URL + o.MUSERS_ID + \"/\" + img;\n  // }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/orders/orders.ts"],"sourceRoot":""}